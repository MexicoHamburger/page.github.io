<!DOCTYPE html>
<html>
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css"
    />

    <title>Sharing Service</title>
    <style>
      .container {
        width: 640px;
      }
    </style>
  </head>

  <body>
    

    <div class="container">
      <!--personal information (phone number)-->
      <div class="input-group mb-3">
        <input
          type="text"
          class="form-control"
          placeholder="phone number (010-xxxx-xxxx)"
          aria-label="personal info"
          id="personal-info"
        />
      </div>

      <!--personal information (phone number)-->
      <div class="input-group mb-3">
        <input
          type="text"
          class="form-control"
          placeholder="number of participants"
          aria-label="participants num"
          id="participants-num"
        />
      </div>

      <!--Category menu-->
      <div class="input-group mb-3">
        <label class="input-group-text" for="inputGroupSelect01"
          >Category</label
        >
        <select class="form-select" id="category">
          <option selected>Choose...</option>
          <option value="1">delivery food</option>
          <option value="2">Taxi</option>
          <option value="3">Others(Parcel, game, Netflix)</option>
        </select>
      </div>

      <!--Place menu-->
      <div class="input-group mb-3">
        <label class="input-group-text" for="inputGroupSelect01">Place</label>
        <select class="form-select" id="place">
          <option selected>Choose...</option>
          <option value="1">000 dormitory</option>
          <option value="2">000 lab</option>
          <option value="3">000 building</option>
        </select>
      </div>

      <!--Time menu-->
      <div class="input-group mb-3">
        <label class="input-group-text" for="inputGroupSelect01">Time</label>
        <select class="form-select" id="time">
          <option selected>Choose...</option>
          <option value="1">11:00 ~ 12:00</option>
          <option value="2">12:00 ~ 13:00</option>
          <option value="3">13:00 ~ 14:00</option>
        </select>
      </div>

      <!--register button (blue box)-->
      <button type="button" id="register" class="btn btn-primary text-nowrap">
        <i class="bi bi-plus"></i> Register
      </button>
    </div>

    

    <div class="container">

      <div class="d-flex">

        <!--Available Participation-->
        <div class="flex-grow-1 bg-light rounded-2 p-2 me-1 w-50">
          <!--personal information for only participation(phone number)-->
      <div class="input-group mb-3 me-4">
        <input
          type="text"
          class="form-control"
          placeholder="phone number (010-xxxx-xxxx) - only participating"
          aria-label="personal info"
          id="only-participate"
        />
      </div>
          <h3>Party available</h3>
          <div id="available-list">
            <div
              class="task bg-light p-1 rounded-2 ps-2 d-flex align-items-center d-flex"
            ></div>
          </div>
        </div>

        
          </div>
          <h3>Participation Status</h3>
          <!--Participation Status box-->
      <div class="d-flex">

        <div class="flex-grow-1 bg-light rounded-2 p-2 me-1 w-50">
          <div id="participate-list">
            <div
              class="task bg-light p-1 rounded-2 ps-2 d-flex align-items-center d-flex"
            ></div>
          </div>
        </div>
      </div>

      <!--communication between participants-->
      <div class="input-group mb-3">
        <input
          type="text"
          id = "communication-input"
          class="form-control"
          placeholder="Communication"
          aria-label="Recipient's username"
          aria-describedby="button-addon2"
        />
        <button
          class="btn btn-outline-secondary"
          type="button"
          id="communication-button"
        >
          Enter
        </button>
      </div>
      <div class="d-flex">
        <!--Chatting box-->
        <div class="flex-grow-1 bg-light rounded-2 p-2 me-1 w-50">
          <h3>Chatting between participants</h3>
          <div id="chatbox">
            <div
              class="task bg-light p-1 rounded-2 ps-2 d-flex align-items-center"
            ></div>
          </div>
        </div>
    </div>


    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
      crossorigin="anonymous"
    ></script>

    <!-- write functions -->
    <script>
      var i = 1;
      // Chat system. Local storage-saving feature should be added
    function addChat() {
      let chatline = document.querySelector("#communication-input");
      let IDline = document.querySelector("#personal-info");
      let text = chatline.value;
      let ID = IDline.value;

      if ((!ID) || (!text)) return;
      let chatdiv = document.createElement("div");
      chatdiv.className = "task bg-light p-1 rounded-2 ps-2 d-flex align-items-center"
      let span = document.createElement("span");
      span.className = "me-auto";
      span.innerHTML = "ID " + ID + ": " + text;
      chatdiv.appendChild(span);

      let chatbox = document.querySelector("#chatbox");
      chatbox.appendChild(chatdiv);

      chatline.value = "";
    }

    // Chat system works when button Clicked or pressed Enter
    let chatbutton = document.querySelector("#communication-button");
      chatbutton.addEventListener("click", () => {
        addChat();
      });
    let chatinputbox = document.querySelector("#communication-input");
    chatinputbox.addEventListener("keyup", (event) => {
      const keyName = event.key;
      if (keyName === 'Enter') addChat();
    });

      function Registering (){
        // profile information
        let input = document.getElementById("personal-info").value;
        let num = document.getElementById("participants-num").value;
        

        // load selected category, place, time options
        let categorySelected = document.getElementById("category");
        categorySelected = categorySelected.options[categorySelected.selectedIndex].text;

        let placeSelected = document.getElementById("place");
        placeSelected = placeSelected.options[placeSelected.selectedIndex].text;

        let timeSelected = document.getElementById("time");
        timeSelected = timeSelected.options[timeSelected.selectedIndex].text;

        // add category, place, time information to available list
       let newInfo = document.createElement("div");
       newInfo.className ="task bg-light p-1 rounded-2 ps-2  d-flex align-items-center";
       // added - dynamically allocated ID, upon button pressed.
       newInfo.id = "PA" + i;
       let partInfo = newInfo.cloneNode(true);
       partInfo.id = "PS" + i;

       let span = document.createElement("span");
       span.className = "me-auto";
       span.innerHTML = categorySelected + " <br/>pick-up: "+ placeSelected + '<br/>' + " time: " + timeSelected + '<br/>' + "number of participants: " + num + '<br/>';
       newInfo.appendChild(span);

       let progbar = document.createElement("progress");
       progbar.value = 100/(num);
       progbar.max = "100";
       progbar.id = "progbar"+i;

       let partspan = span.cloneNode(true);
       partspan.append(progbar);
       partInfo.appendChild(partspan);
       // add participation info to participate list
       let participateList = document.querySelector("#participate-list");
       participateList.appendChild(partInfo);

       // make participation button. Each button has id "participateButton1, participateButton2 ..."
       let buttonParticipate = document.createElement('button');
       buttonParticipate.className = "btn btn-sm btn-success text-nowrap me-auto";
        buttonParticipate.innerHTML = '<i class="bi bi-plus"></i>';
        buttonParticipate.innerText = "+ participate"
        buttonParticipate.id = "participateButton" + i++;
        newInfo.appendChild(buttonParticipate);

       let availableList = document.querySelector("#available-list");
       availableList.appendChild(newInfo);
       // pop up page (about registered information)
       let profile =  "userID: " + input + " ==> participation state: (1/" +num+") \n\n*****register info*****\n"+ categorySelected+ " registered \n"+ placeSelected+" ("+timeSelected+")";
      
       alert(profile);

       // reset all register boxes
      document.querySelector("#personal-info").value = "";
      document.querySelector("#participants-num").value = "";
      document.querySelector("#category").value = "Choose...";
      document.querySelector("#place").value = "Choose...";
      document.querySelector("#time").value = "Choose...";

      }

      // if register button clicked implement Registering function
      let button = document.querySelector("#register");
      button.addEventListener("click", () => {
        Registering();
      });

    </script>
  </body>
</html>